---
# ---------------------------------------------------------
# DOCKER INSTALLATION (Ubuntu/Debian only)
# ---------------------------------------------------------

- name: Verify OS family is Debian/Ubuntu
  ansible.builtin.assert:
    that:
      - ansible_os_family == 'Debian'
    fail_msg: "This role only supports Ubuntu/Debian distributions"

- name: Install Docker for Debian/Ubuntu family
  ansible.builtin.include_tasks: docker-debian.yml

# Common configuration tasks (User group)
- name: Determine user for Docker group
  ansible.builtin.set_fact:
    docker_group_user: >-
      {{
        ansible_env.SUDO_USER |
        default(lookup('env', 'USER')) |
        default(ansible_user_id) |
        default('root')
      }}

- name: Add user to Docker group
  ansible.builtin.user:
    name: "{{ docker_group_user }}"
    groups: docker
    append: true
  notify: Notify user about Docker group change
  when: docker_group_user != 'root'

- name: Display Docker group information
  ansible.builtin.debug:
    msg:
      - "User '{{ docker_group_user }}' has been added to the docker group"
      - "Note: You need to log out and back in for this to take effect"
  when: docker_group_user != 'root'
